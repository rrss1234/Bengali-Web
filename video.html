<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Speed Video Player</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        /* আগের সব স্টাইল ঠিক রেখে নতুন কিছু আপডেট */
        :root {
            --primary-color: #007bff;
            --bg-dark: #0f0f0f;
        }

        body { background: #121212; color: #fff; font-family: sans-serif; }

        .video-container {
            background: #000;
            position: relative;
            max-width: 1000px;
            margin: 80px auto 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        video { width: 100%; display: block; aspect-ratio: 16/9; }

        /* Fast Loading Spinner */
        .video-loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            display: none;
        }

        .spinner-ring {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.1);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .custom-controls {
            position: absolute;
            bottom: 0; width: 100%;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            padding: 15px;
            opacity: 0; transition: 0.3s;
        }

        .video-container:hover .custom-controls { opacity: 1; }

        .progress-container {
            height: 5px; background: rgba(255,255,255,0.2);
            cursor: pointer; margin-bottom: 10px; position: relative;
        }
        .progress-bar { height: 100%; background: var(--primary-color); width: 0; }

        .controls-row { display: flex; align-items: center; gap: 15px; }
        .control-btn { background: none; border: none; color: #fff; cursor: pointer; font-size: 1.2rem; }
        
        .channels-section { max-width: 1000px; margin: 0 auto; background: #1e1e1e; border-radius: 8px; padding: 10px; }
        .search-input { width: 100%; padding: 12px; border-radius: 5px; border: none; background: #333; color: #fff; margin-bottom: 10px; }
        
        .channel-item { 
            display: flex; align-items: center; padding: 10px; 
            border-bottom: 1px solid #333; cursor: pointer; transition: 0.2s;
        }
        .channel-item:hover { background: #2a2a2a; }
        .channel-item.active { border-left: 4px solid var(--primary-color); background: #2a2a2a; }
    </style>
</head>
<body>

    <div class="video-container" id="playerWrapper">
        <div class="video-loader" id="videoLoader">
            <div class="spinner-ring"></div>
        </div>

        <video id="videoPlayer" playsinline></video>

        <div class="custom-controls">
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="controls-row">
                <button class="control-btn" id="playPauseBtn"><i class="fas fa-play"></i></button>
                <button class="control-btn" id="muteBtn"><i class="fas fa-volume-up"></i></button>
                <span style="font-size: 14px;" id="timeDisp">0:00 / 0:00</span>
                <button class="control-btn" style="margin-left: auto;" id="fullScreenBtn"><i class="fas fa-expand"></i></button>
            </div>
        </div>
    </div>

    <div class="channels-section">
        <input type="text" class="search-input" id="searchInput" placeholder="সার্চ করুন আপনার প্রিয় চ্যানেল...">
        <div id="channelsList"></div>
    </div>

    <script>
        const video = document.getElementById('videoPlayer');
        const loader = document.getElementById('videoLoader');
        const playBtn = document.getElementById('playPauseBtn');
        const progressBar = document.getElementById('progressBar');
        const progressCont = document.getElementById('progressContainer');
        let hls = null;

        // --- প্লেয়ার ফাংশনালিটি ---
        
        function playSource(url) {
            showLoader(true);
            
            // যদি আগে থেকে কোনো HLS সেশন থাকে তবে তা বন্ধ করো
            if (hls) {
                hls.destroy();
            }

            // HLS (.m3u8) সাপোর্ট চেক
            if (url.includes('.m3u8')) {
                if (Hls.isSupported()) {
                    hls = new Hls({
                        capLevelToPlayerSize: true,
                        startLevel: -1,
                        appendErrorMaxRetry: 5
                    });
                    hls.loadSource(url);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = url;
                    video.play();
                }
            } else {
                // সাধারণ MP4/WebM লিঙ্ক হলে
                video.src = url;
                video.play();
            }
        }

        // লোডিং এনিমেশন কন্ট্রোল
        function showLoader(show) {
            loader.style.display = show ? 'block' : 'none';
        }

        video.addEventListener('waiting', () => showLoader(true));
        video.addEventListener('playing', () => showLoader(false));
        video.addEventListener('canplay', () => showLoader(false));

        // প্লে/পজ
        playBtn.addEventListener('click', () => {
            if (video.paused) {
                video.play();
                playBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                video.pause();
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        });

        // প্রগ্রেস বার আপডেট
        video.addEventListener('timeupdate', () => {
            const perc = (video.currentTime / video.duration) * 100;
            progressBar.style.width = perc + '%';
            document.getElementById('timeDisp').innerText = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
        });

        progressCont.addEventListener('click', (e) => {
            const scrubTime = (e.offsetX / progressCont.offsetWidth) * video.duration;
            video.currentTime = scrubTime;
        });

        function formatTime(sec) {
            if (isNaN(sec)) return "0:00";
            let m = Math.floor(sec / 60);
            let s = Math.floor(sec % 60);
            return `${m}:${s < 10 ? '0'+s : s}`;
        }

        // ফুলস্ক্রিন
        document.getElementById('fullScreenBtn').addEventListener('click', () => {
            if (video.requestFullscreen) video.requestFullscreen();
            else if (video.webkitRequestFullscreen) video.webkitRequestFullscreen();
        });

        // --- চ্যানেল লিস্ট লোড (আপনার বিদ্যমান লজিক) ---
        // উদাহরণ স্বরূপ একটি চ্যানেল লোড করে দেখাচ্ছি
        // playSource('https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8'); 

        // এখানে আপনার URL থেকে প্লেলিস্ট লোড করার ফাংশনটি কল করুন।
    </script>
</body>
</html>
