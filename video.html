<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playing - Live TV</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root {
            --bg-black: #000000;
            --card-bg: #ffffff;
            --text-white: #ffffff;
            --accent-blue: #2196F3;
            --gray-text: #b3b3b3;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }

        body { background-color: var(--bg-black); color: var(--text-white); overflow-x: hidden; }

        .header { padding: 15px; display: flex; align-items: center; background: #000; }
        .header i { font-size: 1.2rem; margin-right: 15px; cursor: pointer; }

        /* Video Section */
        .video-container {
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            position: relative;
        }

        video { width: 100%; height: 100%; }

        .controls-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 10px; opacity: 1; transition: opacity 0.3s;
        }

        .mid-btns { display: flex; justify-content: center; align-items: center; gap: 40px; flex-grow: 1; }
        .mid-btns i { font-size: 2rem; cursor: pointer; }

        .bottom-controls { display: flex; align-items: center; gap: 10px; font-size: 0.8rem; }
        .progress-bar { flex-grow: 1; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; position: relative; cursor: pointer; }
        .progress-fill { height: 100%; background: #fff; width: 0%; }

        /* Channel Info */
        .info-section { padding: 20px; display: flex; align-items: center; gap: 15px; }
        .logo-circle { width: 55px; height: 55px; border-radius: 50%; border: 2px solid #fff; background: #222; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .logo-circle img { width: 100%; height: 100%; object-fit: cover; }

        .meta h2 { font-size: 1.1rem; }
        .meta p { font-size: 0.8rem; color: var(--gray-text); margin-top: 3px; }

        /* Action Buttons */
        .actions { display: flex; justify-content: space-around; padding: 15px 0; border-bottom: 1px solid #333; }
        .act-btn { text-align: center; font-size: 0.75rem; cursor: pointer; }
        .act-btn i { display: block; font-size: 1.2rem; margin-bottom: 5px; }

        /* Grid Channels */
        .related { padding: 20px; }
        .related h3 { font-size: 1rem; margin-bottom: 15px; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .card { background: var(--card-bg); border-radius: 12px; padding: 12px 8px; text-align: center; position: relative; cursor: pointer; }
        .card img { width: 100%; height: 45px; object-fit: contain; margin-bottom: 8px; }
        .card span { color: #333; font-size: 0.75rem; font-weight: bold; display: block; white-space: nowrap; overflow: hidden; }
        .star { position: absolute; top: 5px; right: 5px; color: var(--accent-blue); font-size: 0.7rem; }

        .loading-text { text-align: center; padding: 20px; color: var(--gray-text); }
    </style>
</head>
<body>

    <div class="header">
        <i class="fas fa-arrow-left" onclick="history.back()"></i>
        <span>Playing</span>
    </div>

    <div class="video-container" id="playerArea">
        <video id="videoPlayer"></video>
        <div class="controls-overlay" id="overlay">
            <div style="text-align: right;"><span id="brandLabel" style="font-size: 0.7rem; background: rgba(0,0,0,0.6); padding: 2px 8px; border-radius: 4px;">LIVE</span></div>
            <div class="mid-btns">
                <i class="fas fa-backward" onclick="rewind()"></i>
                <i class="fas fa-play" id="ppIcon" onclick="togglePlay()"></i>
                <i class="fas fa-forward" onclick="forward()"></i>
            </div>
            <div class="bottom-controls">
                <i class="fas fa-volume-up" id="muteIcon" onclick="toggleMute()"></i>
                <span id="cTime">-00:00</span>
                <div class="progress-bar" onclick="seek(event)">
                    <div class="progress-fill" id="pFill"></div>
                </div>
                <span id="dTime">00:00</span>
                <i class="fas fa-expand" onclick="toggleFull()"></i>
            </div>
        </div>
    </div>

    <div class="info-section">
        <div class="logo-circle" id="mainLogo"><i class="fas fa-tv"></i></div>
        <div class="meta">
            <h2 id="chName">Loading...</h2>
            <p>Watch this channel live streaming 24/7.</p>
        </div>
    </div>

    <div class="actions">
        <div class="act-btn"><i class="fas fa-share-alt"></i>Share</div>
        <div class="act-btn"><i class="far fa-star"></i>My List</div>
        <div class="act-btn"><i class="fab fa-telegram-plane"></i>Join Telegram</div>
    </div>

    <div class="related">
        <h3>Related Channels</h3>
        <div class="grid" id="channelGrid">
            <div class="loading-text">Parsing Playlist...</div>
        </div>
    </div>

<script>
    const video = document.getElementById('videoPlayer');
    const ppIcon = document.getElementById('ppIcon');
    const pFill = document.getElementById('pFill');
    let hls = new Hls();

    // 1. Get Playlist URL from URL Params
    const urlParams = new URLSearchParams(window.location.search);
    const playlistUrl = urlParams.get('playlist');

    // 2. Load and Parse M3U
    async function fetchPlaylist() {
        if (!playlistUrl) return;
        try {
            const response = await fetch(playlistUrl);
            const data = await response.text();
            parseM3U(data);
        } catch (e) {
            document.getElementById('channelGrid').innerHTML = "Error loading playlist.";
        }
    }

    function parseM3U(content) {
        const lines = content.split('\n');
        const channels = [];
        let current = {};

        lines.forEach(line => {
            if (line.startsWith('#EXTINF:')) {
                const nameMatch = line.split(',')[1];
                const logoMatch = line.match(/tvg-logo="([^"]*)"/);
                current.name = nameMatch ? nameMatch.trim() : "Unknown";
                current.logo = logoMatch ? logoMatch[1] : "";
            } else if (line.startsWith('http')) {
                current.url = line.trim();
                channels.push({...current});
                current = {};
            }
        });
        displayChannels(channels);
    }

    function displayChannels(list) {
        const grid = document.getElementById('channelGrid');
        grid.innerHTML = "";
        list.forEach((ch, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <i class="fas fa-star star"></i>
                <img src="${ch.logo || 'https://via.placeholder.com/50?text=TV'}" onerror="this.src='https://via.placeholder.com/50?text=TV'">
                <span>${ch.name}</span>
            `;
            card.onclick = () => playStream(ch.url, ch.name, ch.logo);
            grid.appendChild(card);
            
            // Auto play first channel
            if(index === 0) playStream(ch.url, ch.name, ch.logo);
        });
    }

    function playStream(url, name, logo) {
        document.getElementById('chName').innerText = name;
        document.getElementById('brandLabel').innerText = name.toUpperCase();
        if (logo) {
            document.getElementById('mainLogo').innerHTML = `<img src="${logo}">`;
        }

        if (Hls.isSupported()) {
            hls.destroy();
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.play();
        }
        ppIcon.className = "fas fa-pause";
    }

    // Controls Logic
    function togglePlay() {
        if (video.paused) { video.play(); ppIcon.className = "fas fa-pause"; }
        else { video.pause(); ppIcon.className = "fas fa-play"; }
    }

    function rewind() { video.currentTime -= 10; }
    function forward() { video.currentTime += 10; }
    function toggleMute() {
        video.muted = !video.muted;
        document.getElementById('muteIcon').className = video.muted ? "fas fa-volume-mute" : "fas fa-volume-up";
    }

    video.addEventListener('timeupdate', () => {
        const pct = (video.currentTime / video.duration) * 100;
        pFill.style.width = pct + '%';
        document.getElementById('cTime').innerText = formatTime(video.currentTime);
        document.getElementById('dTime').innerText = formatTime(video.duration);
    });

    function formatTime(s) {
        if (isNaN(s)) return "00:00";
        let m = Math.floor(s / 60);
        let sec = Math.floor(s % 60);
        return (m < 10 ? '0' : '') + m + ":" + (sec < 10 ? '0' : '') + sec;
    }

    function toggleFull() {
        if (video.requestFullscreen) video.requestFullscreen();
        else if (video.webkitRequestFullscreen) video.webkitRequestFullscreen();
    }

    // Auto-hide overlay
    let timer;
    document.getElementById('playerArea').addEventListener('click', () => {
        const ov = document.getElementById('overlay');
        ov.style.opacity = 1;
        clearTimeout(timer);
        timer = setTimeout(() => ov.style.opacity = 0, 3000);
    });

    window.onload = fetchPlaylist;
</script>
</body>
</html>
