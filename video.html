<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live TV Player</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
:root{
    --bg:#000;
    --card:#121212;
    --text:#fff;
    --accent:#2196F3;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}

body{
    background:var(--bg);
    color:var(--text);
    height:100vh;
    display:flex;
    flex-direction:column;
    overflow:hidden;
}

/* Header */
.header{
    height:50px;
    display:flex;
    align-items:center;
    gap:15px;
    padding:0 15px;
    border-bottom:1px solid #222;
    flex-shrink:0;
}
.header i{cursor:pointer}

/* Player */
.video-fixed-top{
    width:100%;
    aspect-ratio:16/9;
    position:relative;
    background:#000;
    flex-shrink:0;
}
video{width:100%;height:100%}

.controls-overlay{
    position:absolute;
    inset:0;
    background:rgba(0,0,0,.6);
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    padding:10px;
    opacity:0;
    pointer-events:none;
    transition:.3s;
}
.controls-overlay.show{
    opacity:1;
    pointer-events:auto;
}

.mid-btns{
    display:flex;
    justify-content:center;
    gap:40px;
    align-items:center;
    flex:1;
}
.mid-btns i{font-size:2.2rem;cursor:pointer}

.bottom-controls{
    display:flex;
    align-items:center;
    gap:10px;
    font-size:.75rem;
}
.progress-bar{
    flex:1;
    height:4px;
    background:#555;
    border-radius:3px;
    cursor:pointer;
}
.progress-fill{
    height:100%;
    width:0%;
    background:var(--accent);
}

/* Scroll area */
.scrollable-content{
    flex:1;
    overflow-y:auto;
    padding:15px;
    -webkit-overflow-scrolling:touch;
}

/* Info */
.info-section{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:15px;
}
.total-badge{
    background:#111;
    padding:4px 10px;
    border-radius:20px;
    font-size:.75rem;
    border:1px solid #333;
    color:var(--accent);
}

/* Action */
.action-row{
    display:flex;
    justify-content:space-around;
    padding:15px 0;
    border-bottom:1px solid #222;
    margin-bottom:15px;
}
.act-btn{
    text-align:center;
    font-size:.75rem;
    cursor:pointer;
    color:#ccc;
}
.act-btn i{
    display:block;
    font-size:1.3rem;
    margin-bottom:5px;
}

/* Channel list */
.channel-list{display:flex;flex-direction:column;gap:10px;}
.channel-row{
    display:flex;
    align-items:center;
    gap:15px;
    background:var(--card);
    padding:10px 15px;
    border-radius:12px;
    border:1px solid #222;
    cursor:pointer;
}
.channel-row.active{
    border-color:var(--accent);
    background:#1a1a1a;
}
.channel-logo-img{
    width:48px;
    height:48px;
    border-radius:8px;
    background:#222;
    object-fit:contain;
}
.star-icon{color:var(--accent)}
</style>
</head>

<body>

<div class="header">
    <i class="fas fa-arrow-left" onclick="history.back()"></i>
    <span>Live Stream</span>
</div>

<div class="video-fixed-top" id="playerArea">
    <video id="videoPlayer" playsinline></video>

    <div class="controls-overlay" id="overlay">
        <div style="text-align:right">
            <span style="font-size:.6rem;background:var(--accent);padding:2px 6px;border-radius:4px">LIVE</span>
        </div>

        <div class="mid-btns">
            <i class="fas fa-backward" onclick="rewind()"></i>
            <i class="fas fa-play" id="ppIcon" onclick="togglePlay()"></i>
            <i class="fas fa-forward" onclick="forward()"></i>
        </div>

        <div class="bottom-controls">
            <i class="fas fa-volume-up" id="muteIcon" onclick="toggleMute()"></i>
            <span id="cTime">00:00</span>
            <div class="progress-bar" onclick="seek(event)">
                <div class="progress-fill" id="pFill"></div>
            </div>
            <span id="dTime">00:00</span>
            <i class="fas fa-expand" onclick="toggleFull()"></i>
        </div>
    </div>
</div>

<div class="scrollable-content">
    <div class="info-section">
        <div>
            <h3 id="currentTitle">Select Channel</h3>
            <small>Watching live stream</small>
        </div>
        <div class="total-badge" id="totalCount">0</div>
    </div>

    <div class="action-row">
        <div class="act-btn" onclick="shareChannel()"><i class="fas fa-share-alt"></i>Share</div>
        <div class="act-btn" onclick="addToMyList()"><i class="far fa-star"></i>My List</div>
        <div class="act-btn" onclick="window.open('https://t.me/yourchannel')"><i class="fab fa-telegram"></i>Telegram</div>
    </div>

    <div class="channel-list" id="listContainer">
        Loading channels...
    </div>
</div>

<script>
const video=document.getElementById('videoPlayer');
const overlay=document.getElementById('overlay');
const ppIcon=document.getElementById('ppIcon');
const pFill=document.getElementById('pFill');
let hls=new Hls(),hideT;

document.getElementById('playerArea').onclick=()=>{
    overlay.classList.add('show');
    clearTimeout(hideT);
    hideT=setTimeout(()=>overlay.classList.remove('show'),3000);
};

/* My List */
function getMyList(){return JSON.parse(localStorage.getItem('myList')||'[]')}
function saveMyList(l){localStorage.setItem('myList',JSON.stringify(l))}

function addToMyList(){
    const t=currentTitle.innerText;
    if(t==="Select Channel")return;
    let l=getMyList();
    l.includes(t)?l=l.filter(i=>i!==t):l.push(t);
    saveMyList(l);
    updateStars();
}

function updateStars(){
    const l=getMyList();
    document.querySelectorAll('.channel-row').forEach(r=>{
        const n=r.querySelector('.channel-name').innerText;
        r.querySelector('.star-icon').className=
            l.includes(n)?"fas fa-star star-icon":"far fa-star star-icon";
    });
}

/* Share */
function shareChannel(){
    const t=currentTitle.innerText;
    if(navigator.share){
        navigator.share({title:t,text:"Watching "+t,url:location.href});
    }else{
        navigator.clipboard.writeText(t+" "+location.href);
        alert("Link copied");
    }
}

/* Player */
function togglePlay(){
    video.paused?(video.play(),ppIcon.className="fas fa-pause"):
    (video.pause(),ppIcon.className="fas fa-play");
}
function rewind(){video.currentTime-=10}
function forward(){video.currentTime+=10}
function toggleMute(){
    video.muted=!video.muted;
    muteIcon.className=video.muted?"fas fa-volume-mute":"fas fa-volume-up";
}
function toggleFull(){
    video.requestFullscreen&&video.requestFullscreen();
}

video.ontimeupdate=()=>{
    if(video.duration){
        pFill.style.width=(video.currentTime/video.duration*100)+"%";
        cTime.innerText=format(video.currentTime);
        dTime.innerText=format(video.duration);
    }
}
function format(s){
    if(isNaN(s))return"00:00";
    return Math.floor(s/60).toString().padStart(2,'0')+":"+
           Math.floor(s%60).toString().padStart(2,'0');
}

/* Playlist */
const playlist=new URLSearchParams(location.search).get('playlist');

fetch(playlist).then(r=>r.text()).then(t=>{
    const lines=t.split('\n');
    let list=[],c={};
    lines.forEach(l=>{
        if(l.startsWith('#EXTINF')){
            c.name=l.split(',')[1];
            const m=l.match(/tvg-logo="([^"]*)"/);
            c.logo=m?m[1]:'';
        }else if(l.startsWith('http')){
            c.url=l.trim();
            list.push({...c});
            c={};
        }
    });
    totalCount.innerText="Channels: "+list.length;
    render(list);
});

function render(list){
    listContainer.innerHTML="";
    list.forEach((c,i)=>{
        const d=document.createElement('div');
        d.className="channel-row";
        d.innerHTML=`
            <img src="${c.logo||'https://via.placeholder.com/50?text=TV'}" class="channel-logo-img">
            <div class="channel-name">${c.name}</div>
            <i class="far fa-star star-icon"></i>`;
        d.onclick=()=>{
            play(c.url,c.name);
            document.querySelectorAll('.channel-row').forEach(x=>x.classList.remove('active'));
            d.classList.add('active');
        };
        listContainer.appendChild(d);
        if(i===0){d.click();}
    });
    updateStars();
}

function play(url,name){
    currentTitle.innerText=name;
    hls.destroy();hls=new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
    ppIcon.className="fas fa-pause";
}
</script>

</body>
</html>
